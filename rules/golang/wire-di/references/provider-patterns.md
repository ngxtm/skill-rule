# Wire Provider Patterns

## Basic Providers

```go
// Provider function returns a dependency
func NewDatabase(cfg *Config) (*Database, error) {
    db, err := sql.Open("postgres", cfg.DSN)
    if err != nil {
        return nil, err
    }
    return &Database{db: db}, nil
}

func NewUserRepository(db *Database) *UserRepository {
    return &UserRepository{db: db}
}

func NewUserService(repo *UserRepository) *UserService {
    return &UserService{repo: repo}
}
```

## Injector Function

```go
// +build wireinject

package main

import "github.com/google/wire"

// InitializeApp creates the application with all dependencies
func InitializeApp(cfg *Config) (*App, error) {
    wire.Build(
        NewDatabase,
        NewUserRepository,
        NewUserService,
        NewApp,
    )
    return nil, nil // Wire generates the actual implementation
}

// Run: wire gen ./...
```

## Provider Sets

```go
// Group related providers
var DatabaseSet = wire.NewSet(
    NewDatabase,
    NewUserRepository,
    NewOrderRepository,
)

var ServiceSet = wire.NewSet(
    NewUserService,
    NewOrderService,
    NewPaymentService,
)

var AppSet = wire.NewSet(
    DatabaseSet,
    ServiceSet,
    NewApp,
)

// Use in injector
func InitializeApp(cfg *Config) (*App, error) {
    wire.Build(AppSet)
    return nil, nil
}
```

## Interface Bindings

```go
// Interface
type UserRepository interface {
    FindByID(id int) (*User, error)
    Save(user *User) error
}

// Implementation
type PostgresUserRepository struct {
    db *Database
}

func NewPostgresUserRepository(db *Database) *PostgresUserRepository {
    return &PostgresUserRepository{db: db}
}

// Bind implementation to interface
var RepositorySet = wire.NewSet(
    NewPostgresUserRepository,
    wire.Bind(new(UserRepository), new(*PostgresUserRepository)),
)

// Service now depends on interface
func NewUserService(repo UserRepository) *UserService {
    return &UserService{repo: repo}
}
```

## Cleanup Functions

```go
// Provider with cleanup
func NewDatabase(cfg *Config) (*Database, func(), error) {
    db, err := sql.Open("postgres", cfg.DSN)
    if err != nil {
        return nil, nil, err
    }
    
    cleanup := func() {
        db.Close()
    }
    
    return &Database{db: db}, cleanup, nil
}

// Injector returns cleanup function
func InitializeApp(cfg *Config) (*App, func(), error) {
    wire.Build(AppSet)
    return nil, nil, nil
}

// Usage
func main() {
    app, cleanup, err := InitializeApp(cfg)
    if err != nil {
        log.Fatal(err)
    }
    defer cleanup() // Cleanup all resources
    
    app.Run()
}
```

## Struct Providers

```go
// Provide struct fields
type Config struct {
    DB     DBConfig
    Server ServerConfig
}

var ConfigSet = wire.NewSet(
    wire.FieldsOf(new(*Config), "DB", "Server"),
)

// Or struct with all exported fields
var ConfigSet = wire.NewSet(
    wire.Struct(new(Config), "*"),
)
```

## Values

```go
// Provide specific values
func InitializeApp() (*App, error) {
    wire.Build(
        wire.Value(Config{Port: 8080}),
        wire.InterfaceValue(new(io.Writer), os.Stdout),
        NewApp,
    )
    return nil, nil
}
```

## Generated Code (wire_gen.go)

```go
// Code generated by Wire. DO NOT EDIT.

package main

func InitializeApp(cfg *Config) (*App, func(), error) {
    database, cleanup, err := NewDatabase(cfg)
    if err != nil {
        return nil, nil, err
    }
    userRepository := NewUserRepository(database)
    userService := NewUserService(userRepository)
    app := NewApp(userService)
    return app, func() {
        cleanup()
    }, nil
}
```
